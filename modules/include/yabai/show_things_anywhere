#!/bin/bash

app_name="Things"  # Replace with the actual app name

# Check if the app is running
if ! yabai -m query --windows | jq -e ".[] | select(.app == \"$app_name\")" >/dev/null 2>&1; then
    # Open the app if it's not running
    open -a "$app_name"3.app
    sleep 1  # Wait for the app to open
else
    # Get the ID of the window belonging to the app
    window_id=$(yabai -m query --windows | jq -r ".[] | select(.app == \"$app_name\") | .id")

    # Check if the window is focused
    if yabai -m query --windows --window "$window_id" | jq -e '."has-focus" == true' >/dev/null 2>&1; then
        # Minimize the window if it's focused
        yabai -m window "$window_id" --minimize
        yabai -m window --focus last
        exit 0
    else
        # Check if the window is minimized
        if yabai -m query --windows --window "$window_id" | jq -e '."is-minimized" == true' >/dev/null 2>&1; then
            # Deminimize the window if it's minimized
            yabai -m window "$window_id" --deminimize
        fi
    fi
fi

# Get the ID of the focused space
focused_space_id=$(yabai -m query --spaces --space | jq -r '.index')

# Get the ID of the window belonging to the app
window_id=$(yabai -m query --windows | jq -r ".[] | select(.app == \"$app_name\") | .id")

# Check if the window is already on the focused space
if ! yabai -m query --windows --window "$window_id" | jq -e '.space == $focused_space_id' >/dev/null 2>&1; then
    # Move the window to the focused space
    yabai -m window "$window_id" --space "$focused_space_id"
fi

# Check if the window is already floating
if ! yabai -m query --windows --window "$window_id" | jq -e '."is-floating" == true' >/dev/null 2>&1; then
    # Make the window floating if it's not already floating
    yabai -m window "$window_id" --toggle float
fi

# Set the window size using the grid functionality
yabai -m window "$window_id" --grid 1:3:0:0:1:1

# Focus the window
yabai -m window "$window_id" --focus
